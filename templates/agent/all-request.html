{% extends 'agent/base.html' %}
{% load crispy_forms_tags %}
{% load static %}

{% block content %}
<div class="container">
    <div class="row mt-6 mb-3">
        <h3>All Requests</h3>
    </div>

    <!-- Card -->
    {% if requests %}
    {% for request in requests %}
    <div class="request-card mt-2">
        <div class="request-card-header-wrapper">
            <a href="/supportdesk/view-request/{{request.id}}"><h4 class="m-0">{{request.title}}</h4></a>
            {% if request.is_priority %}
            <div class="badge badge-danger rounded ml-2">High Priority</div>
            {% endif %}
            <div class="badge border {% if request.status == 'progress' %}text-primary border-primary{% else %}text-success border-success{% endif %} ml-auto rounded">{{request.status}}</div>
        </div>

        <div class="text-body mt-2">
            {{request.description|slice:200}}{% if request.description|length > 200 %}...{% endif %}
        </div>

        <div class="mt-2 request-card-footer-wrapper">
            <div>Created {{request.created_on|timesince}} ago</div>
        </div>

        <div class="mt-2 request-card-footer-wrapper">
            {% if request.assigned_to %}
            <div>Assigned to {{request.assigned_to}}</div>
            {% else %}
            <a href="/supportdesk/assign/{{request.id}}">
                <button class="btn btn-link border-primary border-2 text-primary">
                    <img src="{% static 'assets/img/icons/interface/star.svg' %}" alt="ADD" /> Assign to me
                </button>
            </a>
            {% endif %}
            {% if request.status == "progress" %}
            <a href="/supportdesk/complete/{{request.id}}">
                <button class="btn btn-link border-success border-2 text-success">
                    <img src="{% static 'assets/img/icons/interface/check.svg' %}" alt="Tick" /> Mark as complete
                </button>
            </a>
            {% endif %}
        </div>
    </div>
    {% endfor %}

    {% else %}
    <h3 class="text-center">No request Found</h3>
    {% endif %}
    <!-- Card -->

</div>

{% endblock %}